<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>蓝鲸智云社区版部署 | The Expanse</title><meta name="description" content="产品介绍​        腾讯蓝鲸智云，简称蓝鲸，是腾讯互动娱乐事业群（Interactive Entertainment Group，简称 IEG）自研自用的一套用于构建企业研发运营一体化体系的 PaaS 开发框架，提供了 aPaaS（DevOps 流水线、运行环境托管、前后台框架）和 iPaaS（持续集成、CMDB、作业平台、容器管理、数据平台、AI 等原子平台）等模块，帮助企业技术人员快速构"><meta name="keywords" content="CMBD,蓝鲸智云"><meta name="author" content="Ayqming"><meta name="copyright" content="Ayqming"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="蓝鲸智云社区版部署"><meta name="twitter:description" content="产品介绍​        腾讯蓝鲸智云，简称蓝鲸，是腾讯互动娱乐事业群（Interactive Entertainment Group，简称 IEG）自研自用的一套用于构建企业研发运营一体化体系的 PaaS 开发框架，提供了 aPaaS（DevOps 流水线、运行环境托管、前后台框架）和 iPaaS（持续集成、CMDB、作业平台、容器管理、数据平台、AI 等原子平台）等模块，帮助企业技术人员快速构"><meta name="twitter:image" content="https://i.loli.net/2020/06/08/wRBPJaYEkreNtoO.png"><meta property="og:type" content="article"><meta property="og:title" content="蓝鲸智云社区版部署"><meta property="og:url" content="http://ayqming.github.io/2020/06/07/%E8%93%9D%E9%B2%B8%E6%99%BA%E4%BA%91%E7%A4%BE%E5%8C%BA%E7%89%88%E9%83%A8%E7%BD%B2/"><meta property="og:site_name" content="The Expanse"><meta property="og:description" content="产品介绍​        腾讯蓝鲸智云，简称蓝鲸，是腾讯互动娱乐事业群（Interactive Entertainment Group，简称 IEG）自研自用的一套用于构建企业研发运营一体化体系的 PaaS 开发框架，提供了 aPaaS（DevOps 流水线、运行环境托管、前后台框架）和 iPaaS（持续集成、CMDB、作业平台、容器管理、数据平台、AI 等原子平台）等模块，帮助企业技术人员快速构"><meta property="og:image" content="https://i.loli.net/2020/06/08/wRBPJaYEkreNtoO.png"><meta property="article:published_time" content="2020-06-07T07:34:13.118Z"><meta property="article:modified_time" content="2020-07-08T14:06:02.175Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://ayqming.github.io/2020/06/07/%E8%93%9D%E9%B2%B8%E6%99%BA%E4%BA%91%E7%A4%BE%E5%8C%BA%E7%89%88%E9%83%A8%E7%BD%B2/"><link rel="prev" title="博客更换个人域名" href="http://ayqming.github.io/2020/06/09/%E5%8D%9A%E5%AE%A2%E6%9B%B4%E6%8D%A2%E4%B8%AA%E4%BA%BA%E5%9F%9F%E5%90%8D/"><link rel="next" title="Ansible 知识汇总" href="http://ayqming.github.io/2020/05/04/Ansible%20%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">6</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">8</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#产品介绍"><span class="toc-number">1.</span> <span class="toc-text">产品介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#版本类别"><span class="toc-number">2.</span> <span class="toc-text">版本类别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#功能架构"><span class="toc-number">3.</span> <span class="toc-text">功能架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#环境准备"><span class="toc-number">4.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署准备"><span class="toc-number">5.</span> <span class="toc-text">部署准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载社区版"><span class="toc-number">5.1.</span> <span class="toc-text">下载社区版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置系统环境"><span class="toc-number">5.2.</span> <span class="toc-text">设置系统环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置yum源"><span class="toc-number">5.2.1.</span> <span class="toc-text">配置yum源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他设置"><span class="toc-number">5.2.2.</span> <span class="toc-text">其他设置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部署设置"><span class="toc-number">5.3.</span> <span class="toc-text">部署设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#修改配置文件"><span class="toc-number">5.3.1.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解压证书"><span class="toc-number">5.3.2.</span> <span class="toc-text">解压证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#"><span class="toc-number">5.3.3.</span> <span class="toc-text"></span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开始部署"><span class="toc-number">6.</span> <span class="toc-text">开始部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#错误处理"><span class="toc-number">7.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#登陆使用"><span class="toc-number">8.</span> <span class="toc-text">登陆使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#日常运维"><span class="toc-number">9.</span> <span class="toc-text">日常运维</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://i.loli.net/2020/06/08/wRBPJaYEkreNtoO.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">The Expanse</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">蓝鲸智云社区版部署</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-06-07 15:34:13"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-06-07</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-08 22:06:02"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-07-08</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E8%BF%90%E7%BB%B4%E7%AE%A1%E7%90%86/">运维管理</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.7k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 9 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="产品介绍"><a href="#产品介绍" class="headerlink" title="产品介绍"></a>产品介绍</h2><p>​        腾讯蓝鲸智云，简称蓝鲸，是腾讯互动娱乐事业群（Interactive Entertainment Group，简称 IEG）自研自用的一套用于构建企业研发运营一体化体系的 PaaS 开发框架，提供了 aPaaS（DevOps 流水线、运行环境托管、前后台框架）和 iPaaS（持续集成、CMDB、作业平台、容器管理、数据平台、AI 等原子平台）等模块，帮助企业技术人员快速构建基础运营 PaaS。</p>
<h2 id="版本类别"><a href="#版本类别" class="headerlink" title="版本类别"></a>版本类别</h2><p>​        腾讯蓝鲸智云有 2 个主要版本线：社区版和企业版，根据软件包的功能和技术服务提供方的不同，细分为软件基础包、软件增强包、合作商软件包。各版本的描述和产品内容详见下表：</p>
<table>
<thead>
<tr>
<th align="left">版本类别</th>
<th align="center">详细描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">社区版</td>
<td align="center">可以从腾讯蓝鲸智云官方网站下载，并免费使用，用户以运维社区的个人/企业为主，通过社区力量，协助腾讯蓝鲸更好地验证产品的功能和性能。目前该版本的软件由基础平台（管控平台、配置平台、作业平台、PaaS 平台）和官方提供的 SaaS（节点管理、日志检索、蓝鲸监控、故障自愈、标准运维等）组成，且 PaaS 平台上可运行基于腾讯蓝鲸统一开发框架研发的各种场景 SaaS。</td>
</tr>
<tr>
<td align="left">企业版</td>
<td align="center">企业版是付费软件，通过购买 License 的方式永久授权。用户以企业客户为主。其软件产品在功能、性能、服务等方面均优于社区版。蓝鲸的 “企业版技术合作伙伴” 为软件销售和实施的授权方。</td>
</tr>
</tbody></table>
<h2 id="功能架构"><a href="#功能架构" class="headerlink" title="功能架构"></a>功能架构</h2><p>​        社区版的功能架构图如下，企业版的包含虚化部分的功能。对于中小型的运维场景，企业版足够了。</p>
<p><img src="https://bk.tencent.com/static/images/product/framework_ce.jpg" alt="img"></p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>​        社区版的部署方式包括：单机部署和标准部署。标准部署需要3台服务器，把各个组件分散到不同的服务器上，并且zk,kafka等组件做了分布式。单机部署只需要一台服务器，但是对服务器的要求较高，经过几次不成功的尝试，建议越高越好。</p>
<ul>
<li>虚拟机：8核16G内存500GB硬盘一台</li>
<li>操作系统：CentOS Linux release 7.4.1708 </li>
</ul>
<h2 id="部署准备"><a href="#部署准备" class="headerlink" title="部署准备"></a>部署准备</h2><h3 id="下载社区版"><a href="#下载社区版" class="headerlink" title="下载社区版"></a>下载社区版</h3><p>从官网下载最新的稳定版（完整包）：<a href="https://bk.tencent.com/download/" target="_blank" rel="noopener">https://bk.tencent.com/download/</a> ，我使用的是5.1.28版本。</p>
<p>同时下载部署脚本：<a href="https://bk.tencent.com/download_sdk/" target="_blank" rel="noopener">https://bk.tencent.com/download_sdk/</a> ，我使用1.6版本。</p>
<p>最后需要下载社区版的证书：<a href="https://bk.tencent.com/download_ssl/" target="_blank" rel="noopener">https://bk.tencent.com/download_ssl/</a> ，输入部署服务器的MAC地址即可。（需要使用QQ号登陆）</p>
<h3 id="设置系统环境"><a href="#设置系统环境" class="headerlink" title="设置系统环境"></a>设置系统环境</h3><p>​        根据官方的部署文档要求，需要对系统进行一些设置，提供后面脚本部署的基础环境。</p>
<h4 id="配置yum源"><a href="#配置yum源" class="headerlink" title="配置yum源"></a>配置yum源</h4><p>如果是离线安装的情况，需要配置本地的源；本次部署使用在线的方式，全部更换成腾讯的源。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backup</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.cloud.tencent.com/repo/epel-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.cloud.tencent.com/repo/centos7_base.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<h4 id="其他设置"><a href="#其他设置" class="headerlink" title="其他设置"></a>其他设置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查 SELinux 的状态，如果它已经禁用，可以跳过后面的命令</span></span><br><span class="line">sestatus</span><br><span class="line"><span class="comment"># 通过命令临时禁用 SELinux</span></span><br><span class="line">setenforce 0</span><br><span class="line"><span class="comment"># 或者修改配置文件（需要重启）</span></span><br><span class="line">sed -i <span class="string">'s/^SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查默认防火墙状态，如果返回 not running，可以跳过后面的命令</span></span><br><span class="line">firewall-cmd --state</span><br><span class="line">systemctl stop firewalld    <span class="comment"># 停止 firewalld</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld <span class="comment"># 禁用 firewall 开机启动</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否有 rsync 命令，如果有返回 rsync 路径，可以跳过后面的命令</span></span><br><span class="line"><span class="built_in">which</span> rsync</span><br><span class="line"><span class="comment"># 安装 rsync</span></span><br><span class="line">yum -y install rsync</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止并禁用 NetWorkManager</span></span><br><span class="line">systemctl stop NetworkManager</span><br><span class="line">systemctl <span class="built_in">disable</span> NetworkManager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查当前 root 账号下的 max open files 值</span></span><br><span class="line"><span class="built_in">ulimit</span> -n</span><br><span class="line"><span class="comment"># 如果为默认的 1024，建议通过修改配置文件调整为 102400 或更大</span></span><br><span class="line">cat &lt;&lt; EOF &gt;&gt; /etc/security/limits.conf</span><br><span class="line">root soft nofile 102400</span><br><span class="line">root hard nofile 102400</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 和 ntp 服务器同步时间(离线环境下和内网校时服务器校时)</span></span><br><span class="line">ntpdate cn.pool.ntp.org</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改resolv.conf配置文件，首行DNS地址需为 127.0.0.1，如下所示：</span></span><br><span class="line"></span><br><span class="line">nameserver 127.0.0.1</span><br><span class="line">nameserver 192.168.1.100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装一些常用命令，脚本部署时也会自动安装</span></span><br><span class="line">yum -y install vim lrzsz ntp wget curl git bash-completion bash-completion-extras gcc make lsof pcre pcre-devel zlib zlib-devel openssl openssl-devel dos2unix sysstat iostat iftop iotop net-tools <span class="built_in">bind</span>-utils httpd-tools gcc-c++</span><br></pre></td></tr></table></figure>

<p>此外还需要查看是否存在http代理，最后重启系统，给虚拟机做快照！</p>
<h3 id="部署设置"><a href="#部署设置" class="headerlink" title="部署设置"></a>部署设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传三个下载包到服务器上，解压到/data下（后面都不建议自定义目录，照着官方文档来，方便查异常）</span></span><br><span class="line">tar -zxvf bkce_src-5.1.28.tar.gz -C /data/</span><br></pre></td></tr></table></figure>

<p>在data文件夹下解压生成install和src两个文件夹，在 install 目录下，共有三个配置：</p>
<ul>
<li>install.config</li>
<li>globals.env</li>
<li>ports.env</li>
</ul>
<h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>​        <code>install.config</code> 是模块和服务器对应关系的配置文件，描述在哪些机器上安装哪些模块。标准部署时需要设置。单机部署时，这个文件安装脚本会自动生成，无需自行配置。</p>
<p>​        <code>globals.env</code>该文件定义了各类组件的账号密码信息。 功能开关控制选项等。可根据实际情况进行修改。 配置项含义，请查看文件中的注释。</p>
<ul>
<li>该文件含密码信息，请保证除了 root 用户外，其他用户不可读。</li>
<li>各类账号密码建议修改，注意设置的各类密码不能有 / $ ` &lt; &gt; &amp; 等特殊字符。</li>
<li>配置 HTTP 代理：若公司不能访问外网，但有自己的 proxy，在该配置文件的 BK_PROXY 选项中指定代理地址。</li>
<li><code>HTTP_SCHEMA=http</code> 默 认 HTTP_SCHEMA 设置为 HTTP 即蓝鲸软件全站为 HTTP，若设置为 HTTPS 则蓝鲸软件全站为 HTTPS，可支持 HTTP 和 HTTPS 的切换。</li>
<li>该配置文件中提供了访问蓝鲸三大平台的域名配置，需要提前准备好。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> BK_DOMAIN=<span class="string">"bk.com"</span>                <span class="comment"># 蓝鲸根域名(需要自己准备)</span></span><br><span class="line"><span class="built_in">export</span> PAAS_FQDN=<span class="string">"paas.<span class="variable">$BK_DOMAIN</span>"</span>       <span class="comment"># PAAS 完整域名</span></span><br><span class="line"><span class="built_in">export</span> CMDB_FQDN=<span class="string">"cmdb.<span class="variable">$BK_DOMAIN</span>"</span>       <span class="comment"># CMDB 完整域名</span></span><br><span class="line"><span class="built_in">export</span> JOB_FQDN=<span class="string">"job.<span class="variable">$BK_DOMAIN</span>"</span>         <span class="comment"># JOB 完整域名</span></span><br></pre></td></tr></table></figure>

<p>​      <code>ports.env</code>端口定义。默认情况下，不用修改。特殊场景下，若有端口冲突，可以自行定义。</p>
<h4 id="解压证书"><a href="#解压证书" class="headerlink" title="解压证书"></a>解压证书</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xf ssl_certificates.tar.gz -C /data/src/cert/</span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h2 id="开始部署"><a href="#开始部署" class="headerlink" title="开始部署"></a>开始部署</h2><p>如果部署全部组件，请执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /data/install</span><br><span class="line">$ ./install_minibk -y</span><br></pre></td></tr></table></figure>

<p>如果按需部署，假设只需要 PaaS，CMDB，JOB 平台，请执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /data/install</span><br><span class="line">$ ./install_minibk</span><br><span class="line">$ ./bk_install paas &amp;&amp; ./bk_install cmdb &amp;&amp; ./bk_install job</span><br></pre></td></tr></table></figure>

<p>安装第一步会先创建免密登陆（本机免密，如果是标准部署需要各个节点间做免密访问）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Generating public&#x2F;private rsa key pair.</span><br><span class="line">Created directory &#39;&#x2F;root&#x2F;.ssh&#39;.</span><br></pre></td></tr></table></figure>

<p>然后是安装环境的检查，安装和更新缺少的包，并选择默认的安装位置，强烈建议默认。</p>
<p><img src="https://i.loli.net/2020/06/07/F9AJobIezDK1cGC.png" alt="image-20200607173248317"></p>
<p>之后就是使用rsync拷贝文件到指定为，并提示是否同意腾讯的协议，输入yes。</p>
<p><img src="https://i.loli.net/2020/06/07/ilkYDoa9szpMbLr.png" alt="image-20200607173144942"></p>
<p>脚本会依次安装各大平台组件，注意一下输出屏幕，如果在哪个环节报错了，可能需要手动的查原因解决。</p>
<p>当显示如下图所示，证明这个组件安装成功，可以访问了。</p>
<p><img src="https://i.loli.net/2020/06/07/sGwLRPIlbrW98tv.png" alt="image-20200607175326632"></p>
<p><img src="https://i.loli.net/2020/06/08/cZT7NAXJQ4Sizol.png" alt="image-20200607174911484"></p>
<p>在部署的时候也推荐依次安装组件，这样哪个组件安装出问题后可以解决后再安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 PaaS 平台及其依赖服务，该步骤完成后，可以打开 PaaS 平台。</span></span><br><span class="line">./bk_install paas</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装配置平台及其依赖服务，该步骤完成后，可以打开配置平台，看到蓝鲸业务及示例业务。</span></span><br><span class="line">./bk_install cmdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该步骤完成后，可以打开作业平台，并执行作业。同时在配置平台中可以看到蓝鲸的模块下加入了主机。</span></span><br><span class="line"><span class="comment"># 安装作业平台及其依赖组件，并在安装蓝鲸的服务器上装好 gse_agent 供验证。</span></span><br><span class="line">./bk_install job</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署正式环境及测试环境</span></span><br><span class="line"><span class="comment"># 该步骤完成后可以在开发者中心的服务器信息和第三方服务信息中看到已经成功激活的服务器</span></span><br><span class="line"><span class="comment"># 同时也可以进行 SaaS 应用(除蓝鲸监控和日志检索)的上传部署</span></span><br><span class="line">./bk_install app_mgr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装蓝鲸数据平台基础模块及其依赖服务。安装该模块后，可以开始安装使用 SaaS 应用: 蓝鲸监控和日志检索</span></span><br><span class="line">./bk_install bkdata</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装故障自愈的后台模块及依赖其服务</span></span><br><span class="line"><span class="comment"># 安装该模块后，可以开始安装使用 SaaS 应用: 故障自愈</span></span><br><span class="line">./bk_install fta</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重装 gse_agent 并注册正确的集群模块到配置平台</span></span><br><span class="line"><span class="comment"># 执行完该操作后，可以在配置平台中看到主机按照 install.config 中的配置分布到对应拓扑下</span></span><br><span class="line">./bk_install gse_agent</span><br><span class="line"></span><br><span class="line"><span class="comment">#部署官方 SaaS 到正式环境(通过命令行从 /data/src/official_saas/ 目录自动部署 SaaS )</span></span><br><span class="line"><span class="comment"># 执行完该操作后，可以在蓝鲸工作台看到并使用所有官方 SaaS</span></span><br><span class="line">./bkcec install saas-o</span><br></pre></td></tr></table></figure>



<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>1、install bkdata时报错</p>
<p><img src="https://i.loli.net/2020/06/08/RYBA6Kkm9W1c3vP.png" alt="image-20200607180902235"></p>
<p>​    原因是系统找不到对应的库, 确保 mysql-devel 已经安装，如果你已经安装，可以通过如下命令解决：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查找系统中存在的库文件，然后软链至&#x2F;usr&#x2F;lib下</span><br><span class="line">find &#x2F; -name &#39;*mysqlclient*&#39;</span><br><span class="line">ln -s &#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;libmysqlclient_r.so &#x2F;usr&#x2F;lib&#x2F;libmysqlclient_r.so</span><br><span class="line">ln -s &#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;libmysqlclient.so &#x2F;usr&#x2F;lib&#x2F;libmysqlclient.so</span><br><span class="line">ln -s &#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;libmysqlclient.so.18 &#x2F;usr&#x2F;lib&#x2F;libmysqlclient.so.18</span><br><span class="line">ln -s &#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;libmysqlclient.so.18.0.0 &#x2F;usr&#x2F;lib&#x2F;libmysqlclient.so.18.0.0</span><br><span class="line">#	然后在重新安装bkdata</span><br><span class="line">.&#x2F;bk_install bkdata</span><br></pre></td></tr></table></figure>

<p>2、其他的一些可能遇到的问题：</p>
<p><a href="https://bk.tencent.com/docs/document/5.1/10/243" target="_blank" rel="noopener">https://bk.tencent.com/docs/document/5.1/10/243</a></p>
<h2 id="登陆使用"><a href="#登陆使用" class="headerlink" title="登陆使用"></a>登陆使用</h2><p>全部安装正常完成以后，就可以在浏览器访问Paas平台，在平台上可以看到已经安装的各种应用。</p>
<p><img src="https://i.loli.net/2020/06/08/jqrMJS1WcaGtXnN.png" alt="image-20200607211050112"></p>
<p>可以在开发者中心，下架已经安装的应用，或者创建应用，部署第三方应用等。</p>
<p><img src="https://i.loli.net/2020/06/08/wdlB8ptTaQ4gbon.png" alt="image-20200607213647093"></p>
<h2 id="日常运维"><a href="#日常运维" class="headerlink" title="日常运维"></a>日常运维</h2><p>日常维护主要注意组件的启动停止，以及硬盘空间的清理，这两个部分参考官方的文档即可。因为还没有深入的使用，所以这部分暂时留空，后续会补上。</p>
<p>官方文档：<a href="https://bk.tencent.com/docs/document/5.1/20/668" target="_blank" rel="noopener">https://bk.tencent.com/docs/document/5.1/20/668</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ayqming</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://ayqming.github.io/2020/06/07/%E8%93%9D%E9%B2%B8%E6%99%BA%E4%BA%91%E7%A4%BE%E5%8C%BA%E7%89%88%E9%83%A8%E7%BD%B2/">http://ayqming.github.io/2020/06/07/%E8%93%9D%E9%B2%B8%E6%99%BA%E4%BA%91%E7%A4%BE%E5%8C%BA%E7%89%88%E9%83%A8%E7%BD%B2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://ayqming.github.io" target="_blank">The Expanse</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CMBD/">CMBD</a><a class="post-meta__tags" href="/tags/%E8%93%9D%E9%B2%B8%E6%99%BA%E4%BA%91/">蓝鲸智云</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/07/14/cwFQjbE67Af4pWn.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/06/09/%E5%8D%9A%E5%AE%A2%E6%9B%B4%E6%8D%A2%E4%B8%AA%E4%BA%BA%E5%9F%9F%E5%90%8D/"><img class="prev_cover" src="https://i.loli.net/2020/05/06/s61JNRwOMaCpoWI.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">博客更换个人域名</div></div></a></div><div class="next-post pull_right"><a href="/2020/05/04/Ansible%20%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/"><img class="next_cover" src="https://i.loli.net/2020/05/09/p45tw27cRAEhVC3.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Ansible 知识汇总</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="lv-container" data-id="city" data-uid="MTAyMC81MDk0Ny8yNzQyOQ=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></article></main><footer id="footer" style="background-image: url(https://i.loli.net/2020/06/08/wRBPJaYEkreNtoO.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Ayqming</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer id="ribbon" src="/js/third-party/canvas-ribbon.js" size="100" alpha="0.3" zIndex="-1" mobile="false" data-click="true"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script></body></html>