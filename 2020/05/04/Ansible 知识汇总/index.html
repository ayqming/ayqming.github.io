<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Ansible 知识汇总 | The Expanse</title><meta name="description" content="1、Ansible的简介&amp;emsp;&amp;emsp; Ansible is a radically simple IT automation system. It handles configuration management, application deployment,cloud provisioning,ad-hoc task execution, network automation, a"><meta name="keywords" content="ansible,工具"><meta name="author" content="Ayqming"><meta name="copyright" content="Ayqming"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Ansible 知识汇总"><meta name="twitter:description" content="1、Ansible的简介&amp;emsp;&amp;emsp; Ansible is a radically simple IT automation system. It handles configuration management, application deployment,cloud provisioning,ad-hoc task execution, network automation, a"><meta name="twitter:image" content="https://i.loli.net/2020/05/09/p45tw27cRAEhVC3.png"><meta property="og:type" content="article"><meta property="og:title" content="Ansible 知识汇总"><meta property="og:url" content="http://ayqming.github.io/2020/05/04/Ansible%20%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/"><meta property="og:site_name" content="The Expanse"><meta property="og:description" content="1、Ansible的简介&amp;emsp;&amp;emsp; Ansible is a radically simple IT automation system. It handles configuration management, application deployment,cloud provisioning,ad-hoc task execution, network automation, a"><meta property="og:image" content="https://i.loli.net/2020/05/09/p45tw27cRAEhVC3.png"><meta property="article:published_time" content="2020-05-04T13:40:57.000Z"><meta property="article:modified_time" content="2020-07-09T13:35:38.887Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://ayqming.github.io/2020/05/04/Ansible%20%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/"><link rel="prev" title="蓝鲸智云社区版部署" href="http://ayqming.github.io/2020/06/07/%E8%93%9D%E9%B2%B8%E6%99%BA%E4%BA%91%E7%A4%BE%E5%8C%BA%E7%89%88%E9%83%A8%E7%BD%B2/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">6</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">8</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-comment-dots"></i><span> 留言板</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、Ansible的简介"><span class="toc-number">1.</span> <span class="toc-text">1、Ansible的简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、Ansible的架构"><span class="toc-number">2.</span> <span class="toc-text">2、Ansible的架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、Ansible的安装"><span class="toc-number">3.</span> <span class="toc-text">3、Ansible的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、Ansible的使用"><span class="toc-number">4.</span> <span class="toc-text">4、Ansible的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-配置主机清单"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 配置主机清单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-配置访问主机"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 配置访问主机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-playbook"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 playbook</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-核心模块"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 核心模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#command模块"><span class="toc-number">4.4.1.</span> <span class="toc-text">command模块</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://i.loli.net/2020/05/09/p45tw27cRAEhVC3.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">The Expanse</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-comment-dots"></i><span> 留言板</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Ansible 知识汇总</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-05-04 21:40:57"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-05-04</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-09 21:35:38"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-07-09</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Linux%E5%B7%A5%E5%85%B7/">Linux工具</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.8k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 11 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="1、Ansible的简介"><a href="#1、Ansible的简介" class="headerlink" title="1、Ansible的简介"></a>1、Ansible的简介</h3><p>&emsp;&emsp; Ansible is a radically simple IT automation system. It handles configuration management, application deployment,<br>cloud provisioning,ad-hoc task execution, network automation, and multi-node orchestration.   Ansible makes complex changes like zero-downtime rolling updates with load balancers easy.</p>
<p>​<br>&emsp;&emsp;如同官网介绍所说，ansible是一个IT自动化系统，类似的产品还有Puppet、Chef、Saltstack等等。<br>详细的对比介绍可以参照这篇博文<a href="https://blog.csdn.net/zzq900503/article/details/80143740" target="_blank" rel="noopener">运维管理工具的对比</a> ，简单对比如下表：</p>
<p><img src="https://i.loli.net/2020/05/09/eQOkAiY1TxbhULp.png" alt=""></p>
<h3 id="2、Ansible的架构"><a href="#2、Ansible的架构" class="headerlink" title="2、Ansible的架构"></a>2、Ansible的架构</h3><p>Ansible是开源工具，整个开发过程或二次开发均遵循GPL协议，所以所有源码均可见：<a href="https://github.com/ansible/ansible" target="_blank" rel="noopener">Github项目</a></p>
<p>架构图如下图所示，核心组件包括Inventory、Modules、Plugins、Playbook。其中Inventory存放主机清单，可以分组分级管理。Modules包括自带的和第三方模块。Plugins是对模块功能的补充。Playbook是任务配置的剧本，系统按照剧本中配置的任务执行。</p>
<p><img src="https://i.loli.net/2020/05/10/QFpN3BPeIloTLay.png" alt=""></p>
<p>ansible的工作执行过程如下图所示：</p>
<p><img src="https://i.loli.net/2020/05/10/fNPgJcV1YSLoBQp.png" alt=""></p>
<p>系统里安装了ansible的称为管理端、中心端、控制节点，可以有多个，但是不能使用windows作为管理端。</p>
<p>未安装的主机或设备称为被管理端、客户端、受控节点。在客户端上需要安装 Python 2.4 或以上的版本，如果版本低于 Python 2.5 ，需要额外安装一个模块:python-simplejson。  管理端支持local 、ssh、zeromq 三种方式连接被管理端，默认使用基于ssh的连接。</p>
<p>Ansible任务执行模式分为两种:</p>
<p><strong>ad-hoc模式</strong>：  使用单个模块,支持批量执行单条命令,相当与在bash中执行一句shell命令</p>
<p><strong>playbook模式</strong>： 通过多个task的集合完成一类功能,可以理解为多个ad-hoc的配置文件</p>
<p>可以通过命令可以查看到Ansible提供了一些基础命令，这些命令提供了对应的功能来支持运维工作。<a href="https://docs.ansible.com/ansible/devel/user_guide/command_line_tools.html" target="_blank" rel="noopener">官方文档</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@Ansible ~]<span class="comment"># ls /usr/bin/ | grep ansible | grep -v [0-9]</span></span><br><span class="line">ansible</span><br><span class="line">ansible-config</span><br><span class="line">ansible-connection</span><br><span class="line">ansible-console</span><br><span class="line">ansible-doc</span><br><span class="line">ansible-galaxy</span><br><span class="line">ansible-inventory</span><br><span class="line">ansible-playbook</span><br><span class="line">ansible-pull</span><br><span class="line">ansible-test</span><br><span class="line">ansible-vault</span><br></pre></td></tr></table></figure>

<p><strong>ansible</strong>：</p>
<p>ansible主要用于临时性操作，执行ad-hoc命令，即单条命令。默认后面需要跟主机和选项部分，默认不指定模块时，使用的是command模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible [pattern] -m [module] -a <span class="string">"[module options]"</span></span><br></pre></td></tr></table></figure>

<p><strong>ansible-doc</strong>:</p>
<p>该指令功能和Linux的man命令类似，不加参数运行时显示模块详细信息，常用参数有两个-l 和 -s。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出所有已安装的模块</span></span><br><span class="line">$ ansible-doc  -l</span><br><span class="line"><span class="comment">#简介的显示模块的帮助信息</span></span><br><span class="line">$ ansible-doc  -s <span class="built_in">command</span></span><br></pre></td></tr></table></figure>

<p><strong>ansible-galaxy</strong>:</p>
<p>ansible-galaxy 指令用于方便的从<a href="https://galaxy.ansible.com/" target="_blank" rel="noopener">https://galaxy.ansible.com/</a> 站点（类似于dockerhub）下载第三方扩展模块，可以自己搭建内部的Galaxy服务器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-galaxy collection install my_namespace.my_collection</span><br></pre></td></tr></table></figure>

<p><strong>ansible-config</strong>:</p>
<p>用于查看、编辑管理ansible的配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-config [-h] [--version] [-v] &#123;list,dump,view&#125; ...</span><br></pre></td></tr></table></figure>

<p><strong>ansible-playbook</strong>:</p>
<p>该指令是日常用的最多的命令，其通过读取playbook 文件后，执行相应的动作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">usage: ansible-playbook [-h] [--version] [-v] [-k]</span><br><span class="line">                     [--private-key PRIVATE_KEY_FILE] [-u REMOTE_USER]</span><br><span class="line">                     [-c CONNECTION] [-T TIMEOUT]</span><br><span class="line">                     [--ssh-common-args SSH_COMMON_ARGS]</span><br><span class="line">                     [--sftp-extra-args SFTP_EXTRA_ARGS]</span><br><span class="line">                     [--scp-extra-args SCP_EXTRA_ARGS]</span><br><span class="line">                     [--ssh-extra-args SSH_EXTRA_ARGS] [--force-handlers]</span><br><span class="line">                     [--flush-cache] [-b] [--become-method BECOME_METHOD]</span><br><span class="line">                     [--become-user BECOME_USER] [-K] [-t TAGS]</span><br><span class="line">                     [--skip-tags SKIP_TAGS] [-C] [--syntax-check] [-D]</span><br><span class="line">                     [-i INVENTORY] [--list-hosts] [-l SUBSET]</span><br><span class="line">                     [-e EXTRA_VARS] [--vault-id VAULT_IDS]</span><br><span class="line">                     [--ask-vault-password | --vault-password-file VAULT_PASSWORD_FILES]</span><br><span class="line">                     [-f FORKS] [-M MODULE_PATH] [--list-tasks]</span><br><span class="line">                     [--list-tags] [--step] [--start-at-task START_AT_TASK]</span><br><span class="line">                     playbook [playbook ...]</span><br></pre></td></tr></table></figure>



<p><strong>ansible-pull</strong>：</p>
<p>ansible默认使用的是push模式，这个和通常使用的push模式的工作机制正好相反。适用于，有数量巨大的机器需要配置；要在刚启动的，没有联网的主机上执行ansible。</p>
<p><strong>ansible-console</strong>：</p>
<p>基于dominis’ ansible-shell，属于ansible自己的终端，在可以对主机执行临时任务，用的不多。</p>
<p><strong>ansible-inventory</strong>：</p>
<p>查看被控制端主机清单的详细信息默认情况下它使用库存脚本,返回JSON格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@Ansible ~]<span class="comment"># ansible-inventory --list</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_meta"</span>: &#123;</span><br><span class="line">        <span class="string">"hostvars"</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"all"</span>: &#123;</span><br><span class="line">        <span class="string">"children"</span>: [</span><br><span class="line">            <span class="string">"testserver"</span>,</span><br><span class="line">            <span class="string">"ungrouped"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"testserver"</span>: &#123;</span><br><span class="line">        <span class="string">"hosts"</span>: [</span><br><span class="line">            <span class="string">"10.10.0.149"</span>,</span><br><span class="line">            <span class="string">"10.10.0.109"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ansible-vault</strong></p>
<p>主要用于配置文件的加密，如编写的playbook配置文件中包含敏感的信息，ansible-vault可加密/解密这个配置文件。这种playbook文件在执行时，需要加上 –ask-vault-pass参数，同样需要输入密码后才能正常执行。</p>
<h3 id="3、Ansible的安装"><a href="#3、Ansible的安装" class="headerlink" title="3、Ansible的安装"></a>3、Ansible的安装</h3><p>在控制节点安装ansible的办法有三种：源码安装、yum/apt方式安装、通过pip安装，可以根据自己的需求选择。</p>
<p>本文介绍在CentOS 7.4 环境下，python版本2.7.5，使用YUM方式安装ansible 2.9.7版本。</p>
<p>RHEL或CentOS用户，需要 <a href="http://fedoraproject.org/wiki/EPEL" target="_blank" rel="noopener">配置 EPEL</a></p>
<p>首先替换服务器yum源为163源：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">wget http://mirrors.163.com/.<span class="built_in">help</span>/CentOS7-Base-163.repo</span><br><span class="line">sed -i <span class="string">"s;\$releasever;7;g"</span> CentOS7-Base-163.repo</span><br><span class="line">mv CentOS-Base.repo CentOS-Base.repo.bk</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<p>然后安装epel源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>最后安装ansible</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install ansible</span><br></pre></td></tr></table></figure>

<p>安装目录如下：<br> 　配置文件目录：/etc/ansible/<br> 　执行文件目录：/usr/bin/<br> 　Lib库依赖目录：/usr/lib/pythonX.X/site-packages/ansible/<br> 　Help文档目录：/usr/share/doc/ansible-X.X.X/<br> 　Man文档目录：/usr/share/man/man1/<br> 　<br>ansible 的配置文件为/etc/ansible/ansible.cfg，大部分配置节都是默认配置，需要关注的如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">inventory = /etc/ansible/hosts		<span class="comment">#资源清单inventory文件的位置</span></span><br><span class="line">library = /usr/share/ansible		<span class="comment">#指向存放Ansible模块的目录，支持多个目录方式冒号隔开</span></span><br><span class="line">forks = 5		<span class="comment">#并发连接数，默认为5</span></span><br><span class="line">sudo_user = root		<span class="comment">#设置默认执行命令的用户</span></span><br><span class="line">remote_port = 22		<span class="comment">#指定连接被管节点的管理端口，默认为22端口</span></span><br><span class="line">host_key_checking = False		<span class="comment">#设置是否检查SSH主机的密钥</span></span><br><span class="line">timeout = 60		<span class="comment">#设置SSH连接的超时时间，单位为秒</span></span><br><span class="line">log_path = /var/<span class="built_in">log</span>/ansible.log		<span class="comment">#指定一个存储ansible日志的文件（默认不记录日志）</span></span><br></pre></td></tr></table></figure>


<h3 id="4、Ansible的使用"><a href="#4、Ansible的使用" class="headerlink" title="4、Ansible的使用"></a>4、Ansible的使用</h3><h4 id="4-1-配置主机清单"><a href="#4-1-配置主机清单" class="headerlink" title="4.1 配置主机清单"></a>4.1 配置主机清单</h4><p>配置主机清单，把受控节点添加到 inventory 文件里， 默认的文件路径为 /etc/ansible/hosts</p>
<p>主机可以按主机和组管理，且可以添加变量，官方例子如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ex 1: Ungrouped hosts, specify before any group headers.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## green.example.com</span></span><br><span class="line"><span class="comment">## blue.example.com</span></span><br><span class="line"><span class="comment">## 192.168.100.1</span></span><br><span class="line"><span class="comment">## 192.168.100.10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ex 2: A collection of hosts belonging to the 'webservers' group</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## [webservers]</span></span><br><span class="line"><span class="comment">## alpha.example.org</span></span><br><span class="line"><span class="comment">## beta.example.org</span></span><br><span class="line"><span class="comment">## 192.168.1.100</span></span><br><span class="line"><span class="comment">## 192.168.1.110</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you have multiple hosts following a pattern you can specify</span></span><br><span class="line"><span class="comment"># them like this:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## www[001:006].example.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ex 3: A collection of database servers in the 'dbservers' group</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## [dbservers]</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## db01.intranet.mydomain.net</span></span><br><span class="line"><span class="comment">## db02.intranet.mydomain.net</span></span><br><span class="line"><span class="comment">## 10.25.1.56</span></span><br><span class="line"><span class="comment">## 10.25.1.57</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Here's another example of host ranges, this time there are no</span></span><br><span class="line"><span class="comment"># leading 0s:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## db-[99:101]-node.example.com</span></span><br></pre></td></tr></table></figure>

<p>组支持创建子成员</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[atlanta]</span><br><span class="line">host1</span><br><span class="line">host2</span><br><span class="line"></span><br><span class="line">[raleigh]</span><br><span class="line">host2</span><br><span class="line">host3</span><br><span class="line"></span><br><span class="line">[southeast:children]</span><br><span class="line">atlanta</span><br><span class="line">raleigh</span><br><span class="line"></span><br><span class="line">[southeast:vars]</span><br><span class="line">some_server=foo.southeast.example.com</span><br><span class="line">halon_system_timeout=30</span><br><span class="line">self_destruct_countdown=60</span><br><span class="line">escape_pods=2</span><br><span class="line"></span><br><span class="line">[usa:children]</span><br><span class="line">southeast</span><br><span class="line">northeast</span><br><span class="line">southwest</span><br><span class="line">northwest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主机配置参数</span></span><br><span class="line">some_host         ansible_ssh_port=2222     ansible_ssh_user=manager</span><br></pre></td></tr></table></figure>

<h4 id="4-2-配置访问主机"><a href="#4-2-配置访问主机" class="headerlink" title="4.2 配置访问主机"></a>4.2 配置访问主机</h4><p>Ansible默认是通过SSH key和被控主机进行通信，也支持SSH password进行通信。 需要将控制主机上的公钥放到被控主机的/root/.ssh/authorized_keys文件中。</p>
<p>配置免密登陆登陆被控主机，需要用到ssh-keygen和ssh-copy-id两个命令，可以通过yum安装。</p>
<p>在控制端生成SSH公钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Ansible ~]<span class="comment"># ssh-keygen</span></span><br><span class="line"></span><br><span class="line">-t: 密钥类型,可以选择 dsa|ecdsa|ed25519|rsa; 默认是rsa</span><br><span class="line">-f: 密钥目录位置,默认为当前用户home路径下的.ssh隐藏目录,~/.ssh/, root用户在/root/.ssh/id_rsa, 其他用户在/home/username/.ssh/id_rsa;</span><br><span class="line">-C: 指定此密钥的备注信息, 需要配置多个免密登录时, 建议携带;</span><br><span class="line">-N: 指定此密钥对的密码, 如果指定此参数, 则命令执行过程中就不会出现交互确认密码的信息</span><br></pre></td></tr></table></figure>
<p>将公钥拷贝到被控端：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定要拷贝的本地公钥、被控端主机的IP+用户名+端口号:</span></span><br><span class="line">[root@Ansible ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_rsa.pub -p 22 root@被控端IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 公钥会被添加到被控机的authorized_keys文件中，因此也可以通过scp等方式拷贝公钥到被控主机后，将内容手动添加到该文件中。</span></span><br></pre></td></tr></table></figure>
<p>之后就可以直接通过SSH免密登陆被控主机了。</p>
<h4 id="4-3-playbook"><a href="#4-3-playbook" class="headerlink" title="4.3 playbook"></a>4.3 playbook</h4><p>&emsp;&emsp;Playbooks 是 Ansible的配置、部署、编排语言，可以理解为一组执行计划或者命令合集，使用YAML语言编写。playbooks里的命令按从上到下的顺序依次执行，不同于单命令模式，它可以做到传递参数。比如从某一台主机读取内容赋给变量，再传递给下一台主机使用。<br>&emsp;&emsp;在 play 之中，一组主机被映射为定义好的角色。在 ansible 中，play 的内容被称为 tasks，即任务。一个任务是一个对 ansible 模块的调用。一个任务执行完毕之后，下一个 task 才会执行。如果有一组主机中有一个执行任务失败，则会被剔除出该组。<br>&emsp;&emsp;modules 具有”幂等”性：意思是如果再一次地执行 moudle，moudle 只会执行必要的改动，只会改变需要改变的地方，所以重复多次执行 playbook 也很安全。</p>
<p>playbook主要有以下四部分构成:</p>
<ul>
<li>Target section： 用于定义将要执行playbook的远程主机组及远程主机组上的用户、连接方式</li>
<li>Variable section： 定义playbook运行时需要使用的变量</li>
<li>Task section： 定义将要在远程主机上执行的任务列表</li>
<li>Handler section： 定义task执行完成以后需要调用的任务</li>
</ul>
<p>一个示例test.yml:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Target section:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span>	<span class="comment"># 主机、一个或多个组的patterns</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span> <span class="comment"># 执行的用户</span></span><br><span class="line"><span class="comment"># Variable section: </span></span><br><span class="line">  <span class="attr">vars:</span>		</span><br><span class="line">    <span class="attr">http_port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">max_clients:</span> <span class="number">200</span></span><br><span class="line"><span class="comment">#  Task section:</span></span><br><span class="line"> <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">apache</span> <span class="string">is</span> <span class="string">at</span> <span class="string">the</span> <span class="string">latest</span> <span class="string">version</span> 	<span class="comment"># 任务名称备注</span></span><br><span class="line">    <span class="attr">yum:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">write</span> <span class="string">the</span> <span class="string">apache</span> <span class="string">config</span> <span class="string">file</span></span><br><span class="line">    <span class="attr">template:</span>	<span class="comment"># 使用template模块传递含参数的配置文件到被控主机</span></span><br><span class="line">      <span class="attr">src:</span> <span class="string">/srv/httpd.j2</span></span><br><span class="line">      <span class="attr">dest:</span> <span class="string">/etc/httpd.conf</span></span><br><span class="line">    <span class="attr">notify:</span>		<span class="comment"># 监视任务</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">restart</span> <span class="string">apache</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">apache</span> <span class="string">is</span> <span class="string">running</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line"><span class="comment"># Handler section：      </span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">apache</span>	<span class="comment">#必须和notify内容一致</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure>

<p>执行playbooks的命令是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Ansible ~]# ansible-playbook test.yml</span><br></pre></td></tr></table></figure>


<h4 id="4-4-核心模块"><a href="#4-4-核心模块" class="headerlink" title="4.4 核心模块"></a>4.4 核心模块</h4><p>模块(也被称为 “task plugins” 或 “library plugins”)，是执行命令或任务时实际运行的功能。<br>可以使用ansible-doc命令来查询模块和模块信息，大部分模块都可以附带参数。</p>
<p>ansible 团队负责维护核心模块，源码托管在 Github 的 ansible-modules-core repo中。</p>
<h5 id="command模块"><a href="#command模块" class="headerlink" title="command模块"></a>command模块</h5><p>命令模块，常用于ad-hoc模式，但是无法支持”&lt;”，”&gt;”，”|”，”;”，”&amp;”等符号，只能运行于shell中的命令都不支持</p>
<table>
<thead>
<tr>
<th>常用参数</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>chdir</td>
<td>在执行命令前，先进入到指定目录中</td>
</tr>
<tr>
<td>creates</td>
<td>判断指定文件是否存在，如果存在，不执行后面的操作</td>
</tr>
<tr>
<td>removes</td>
<td>判断指定文件是否存在，如果存在，执行后面的操作</td>
</tr>
<tr>
<td>free_form</td>
<td>必须要输入一个合理的命令</td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">return</span> <span class="string">motd</span> <span class="string">to</span> <span class="string">registered</span> <span class="string">var</span></span><br><span class="line">  <span class="attr">command:</span> <span class="string">cat</span> <span class="string">/etc/motd</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">mymotd</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">command</span> <span class="string">if</span> <span class="string">/path/to/database</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exist</span> <span class="string">(without</span> <span class="string">'args'</span> <span class="string">keyword).</span></span><br><span class="line">  <span class="attr">command:</span> <span class="string">/usr/bin/make_database.sh</span> <span class="string">db_user</span> <span class="string">db_name</span> <span class="string">creates=/path/to/database</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 'args' is a task keyword, passed at the same level as the module</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">command</span> <span class="string">if</span> <span class="string">/path/to/database</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exist</span> <span class="string">(with</span> <span class="string">'args'</span> <span class="string">keyword).</span></span><br><span class="line">  <span class="attr">command:</span> <span class="string">/usr/bin/make_database.sh</span> <span class="string">db_user</span> <span class="string">db_name</span></span><br><span class="line">  <span class="attr">args:</span></span><br><span class="line">    <span class="attr">creates:</span> <span class="string">/path/to/database</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 'cmd' is module parameter</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">command</span> <span class="string">if</span> <span class="string">/path/to/database</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exist</span> <span class="string">(with</span> <span class="string">'cmd'</span> <span class="string">parameter).</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">    <span class="attr">cmd:</span> <span class="string">/usr/bin/make_database.sh</span> <span class="string">db_user</span> <span class="string">db_name</span></span><br><span class="line">    <span class="attr">creates:</span> <span class="string">/path/to/database</span></span><br></pre></td></tr></table></figure>








</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ayqming</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://ayqming.github.io/2020/05/04/Ansible%20%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/">http://ayqming.github.io/2020/05/04/Ansible%20%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://ayqming.github.io" target="_blank">The Expanse</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ansible/">ansible</a><a class="post-meta__tags" href="/tags/%E5%B7%A5%E5%85%B7/">工具</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/07/15/iNMFKdobAv7axyP.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/06/07/%E8%93%9D%E9%B2%B8%E6%99%BA%E4%BA%91%E7%A4%BE%E5%8C%BA%E7%89%88%E9%83%A8%E7%BD%B2/"><img class="prev_cover" src="https://i.loli.net/2020/06/08/wRBPJaYEkreNtoO.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">蓝鲸智云社区版部署</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="lv-container" data-id="city" data-uid="MTAyMC81MDk0Ny8yNzQyOQ=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></article></main><footer id="footer" style="background-image: url(https://i.loli.net/2020/05/09/p45tw27cRAEhVC3.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Ayqming</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer id="ribbon" src="/js/third-party/canvas-ribbon.js" size="100" alpha="0.3" zIndex="-1" mobile="false" data-click="true"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script></body></html>